<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ç”£ç§‘ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ">
  <title>ç”£ç§‘å•è¨ºãƒ—ãƒ­ãƒ–ãƒ¬ãƒ æŠ½å‡º</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f3f4f6; min-height: 100vh; }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
    .header { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 16px; margin-bottom: 16px; }
    .header h1 { font-size: 18px; color: #1f2937; margin-bottom: 16px; }
    .btn { padding: 10px 16px; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; }
    .btn-gray { background: #4b5563; color: white; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-primary:disabled { background: #9ca3af; cursor: not-allowed; }
    .content-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 1024px) { .content-grid { grid-template-columns: 2fr 1fr; } }
    .form-section { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 16px; overflow: hidden; }
    .section-header { padding: 12px 16px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .section-header:hover { background: #f3f4f6; }
    .section-title { font-weight: 600; color: #374151; font-size: 15px; }
    .section-content { padding: 16px; display: none; }
    .section-content.expanded { display: block; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px; }
    .form-input { width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
    .form-input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .checkbox-label { display: flex; align-items: center; gap: 6px; font-size: 13px; }
    .checkbox-label input[type="checkbox"] { width: 16px; height: 16px; }
    .radio-group { display: flex; gap: 12px; flex-wrap: wrap; }
    .radio-label { display: flex; align-items: center; gap: 6px; font-size: 13px; }
    .flex-gap { display: flex; gap: 8px; align-items: center; }
    .readonly-display { padding: 8px 12px; background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
    .problem-list { background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%); border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: sticky; top: 16px; }
    .problem-list h2 { font-size: 18px; color: #1f2937; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
    .problem-item { padding: 10px 12px; border-radius: 8px; border: 2px solid; font-weight: 500; font-size: 13px; margin-bottom: 8px; }
    .problem-high { background: #fee2e2; color: #991b1b; border-color: #fca5a5; }
    .problem-medium { background: #fef3c7; color: #92400e; border-color: #fcd34d; }
    .problem-low { background: #dbeafe; color: #1e40af; border-color: #93c5fd; }
    .legend { margin-top: 16px; padding-top: 12px; border-top: 1px solid #d1d5db; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; margin-bottom: 4px; }
    .legend-box { width: 14px; height: 14px; border-radius: 3px; border: 2px solid; }
    .alert-box { padding: 10px; border-left: 4px solid; border-radius: 4px; margin-bottom: 12px; font-size: 12px; font-weight: 600; }
    .alert-red { background: #fef2f2; border-color: #ef4444; color: #991b1b; }
    .alert-orange { background: #fff7ed; border-color: #f97316; color: #9a3412; }
    .help-text { font-size: 11px; color: #6b7280; margin-top: 2px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¥ ç”£ç§‘å•è¨ºãƒ—ãƒ­ãƒ–ãƒ¬ãƒ æŠ½å‡º</h1>
      <button class="btn btn-gray" onclick="resetForm()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="content-grid">
      <div>
        <!-- åŸºæœ¬æƒ…å ± -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('basic')">
            <span class="section-title">0. åŸºæœ¬æƒ…å ±</span>
            <span id="arrow-basic">â–¼</span>
          </div>
          <div class="section-content expanded" id="content-basic">
            <div class="grid-2">
              <div class="form-group">
                <label class="form-label">å¹´é½¢</label>
                <input type="number" class="form-input" id="age" oninput="updateProblems()">
              </div>
              <div class="form-group">
                <label class="form-label">èº«é•· (cm)</label>
                <input type="number" class="form-input" id="height" oninput="updateProblems()">
              </div>
              <div class="form-group">
                <label class="form-label">å¦Šå¨ å‰ä½“é‡ (kg)</label>
                <input type="number" step="0.1" class="form-input" id="preWeight" oninput="updateProblems()">
              </div>
              <div class="form-group">
                <label class="form-label">BMI</label>
                <div class="readonly-display" id="bmiDisplay">---</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ç”£ç§‘æ—¢å¾€ -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('obs')">
            <span class="section-title">1. ç”£ç§‘æ—¢å¾€</span>
            <span id="arrow-obs">â–¼</span>
          </div>
          <div class="section-content expanded" id="content-obs">
            <div class="grid-3">
              <div class="form-group">
                <label class="form-label">å¦Šå¨ å›æ•° (G)</label>
                <input type="number" class="form-input" id="gravida" oninput="updateProblems()">
              </div>
              <div class="form-group">
                <label class="form-label">åˆ†å¨©å›æ•° (P)</label>
                <input type="number" class="form-input" id="para" oninput="updateProblems()">
              </div>
              <div class="form-group">
                <label class="form-label">å¸ç‹åˆ‡é–‹</label>
                <input type="number" class="form-input" id="cesarean" oninput="updateProblems()">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">å‰å›ãƒ»éå»å¦Šå¨ ã®åˆä½µç—‡</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="prevGDM" onchange="updateProblems()"><span>GDM</span></label>
                <label class="checkbox-label"><input type="checkbox" id="prevHDP" onchange="updateProblems()"><span>å¦Šå¨ é«˜è¡€åœ§ç—‡å€™ç¾¤</span></label>
                <label class="checkbox-label"><input type="checkbox" id="prevPreterm" onchange="updateProblems()"><span>åˆ‡è¿«æ—©ç”£/æ—©ç”£</span></label>
                <label class="checkbox-label"><input type="checkbox" id="prevPlacenta" onchange="updateProblems()"><span>å‰ç½®èƒç›¤/ä½ç½®èƒç›¤</span></label>
                <label class="checkbox-label"><input type="checkbox" id="prevPPH" onchange="updateProblems()"><span>ç”£å¾Œå‡ºè¡€</span></label>
                <label class="checkbox-label"><input type="checkbox" id="prevAdhesion" onchange="updateProblems()"><span>ç™’ç€èƒç›¤ç–‘ã„æ—¢å¾€</span></label>
                <label class="checkbox-label"><input type="checkbox" id="prevRapidLabor" onchange="updateProblems()"><span>åˆ†å¨©çµŒéæ—©ã„</span></label>
                <label class="checkbox-label"><input type="checkbox" id="prevPROM" onchange="updateProblems()"><span>å‰æœŸç ´æ°´</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="checkbox-label"><input type="checkbox" id="lastDeliveryWithin1Year" onchange="updateProblems()"><span>å‰å›åˆ†å¨©ãŒ1å¹´æœªæº€</span></label>
            </div>
          </div>
        </div>

        <!-- æ—¢å¾€æ­´ -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('medical')">
            <span class="section-title">2. æ—¢å¾€æ­´</span>
            <span id="arrow-medical">â–¼</span>
          </div>
          <div class="section-content" id="content-medical">
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="hypertension" onchange="updateProblems()"><span>é«˜è¡€åœ§</span></label>
              <label class="checkbox-label"><input type="checkbox" id="diabetes" onchange="updateProblems()"><span>ç³–å°¿ç—…</span></label>
              <label class="checkbox-label"><input type="checkbox" id="thyroid" onchange="updateProblems()"><span>ç”²çŠ¶è…ºç–¾æ‚£</span></label>
              <label class="checkbox-label"><input type="checkbox" id="autoimmune" onchange="updateProblems()"><span>è‡ªå·±å…ç–«ç–¾æ‚£</span></label>
              <label class="checkbox-label"><input type="checkbox" id="thrombosis" onchange="updateProblems()"><span>è¡€æ “ç—‡æ­´</span></label>
              <label class="checkbox-label"><input type="checkbox" id="asthma" onchange="updateProblems()"><span>å–˜æ¯</span></label>
              <label class="checkbox-label"><input type="checkbox" id="psychiatric" onchange="updateProblems()"><span>ç²¾ç¥ç–¾æ‚£</span></label>
              <label class="checkbox-label"><input type="checkbox" id="uterineFibroid" onchange="updateProblems()"><span>å­å®®ç­‹è…«</span></label>
              <label class="checkbox-label"><input type="checkbox" id="uterineAnomaly" onchange="updateProblems()"><span>å­å®®å¥‡å½¢</span></label>
              <label class="checkbox-label"><input type="checkbox" id="cervicalSurgery" onchange="updateProblems()"><span>å­å®®é ¸éƒ¨æ‰‹è¡“æ­´</span></label>
              <label class="checkbox-label"><input type="checkbox" id="abdominalSurgery" onchange="updateProblems()"><span>è…¹éƒ¨æ‰‹è¡“æ­´</span></label>
            </div>
          </div>
        </div>

        <!-- å†…æœè–¬ -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('meds')">
            <span class="section-title">3. å†…æœè–¬</span>
            <span id="arrow-meds">â–¼</span>
          </div>
          <div class="section-content" id="content-meds">
            <div class="alert-box alert-red">âš ï¸ å‚¬å¥‡å½¢æ€§ãƒªã‚¹ã‚¯ã®ã‚ã‚‹è–¬å‰¤</div>
            <div class="form-group">
              <label class="form-label" style="color: #991b1b; font-weight: 600;">æŠ—ã¦ã‚“ã‹ã‚“è–¬</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="aed_valproate" onchange="updateProblems()"><span>ãƒãƒ«ãƒ—ãƒ­é…¸</span></label>
                <label class="checkbox-label"><input type="checkbox" id="aed_carbamazepine" onchange="updateProblems()"><span>ã‚«ãƒ«ãƒãƒã‚¼ãƒ”ãƒ³</span></label>
                <label class="checkbox-label"><input type="checkbox" id="aed_phenytoin" onchange="updateProblems()"><span>ãƒ•ã‚§ãƒ‹ãƒˆã‚¤ãƒ³</span></label>
                <label class="checkbox-label"><input type="checkbox" id="aed_other" onchange="updateProblems()"><span>ãã®ä»–æŠ—ã¦ã‚“ã‹ã‚“è–¬</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" style="color: #991b1b; font-weight: 600;">ãƒ“ã‚¿ãƒŸãƒ³Aèª˜å°ä½“</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="retinoid_isotretinoin" onchange="updateProblems()"><span>ã‚¤ã‚½ãƒˆãƒ¬ãƒãƒã‚¤ãƒ³</span></label>
                <label class="checkbox-label"><input type="checkbox" id="retinoid_acitretin" onchange="updateProblems()"><span>ã‚¢ã‚·ãƒˆãƒ¬ãƒãƒ³</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" style="color: #991b1b; font-weight: 600;">å…ç–«æŠ‘åˆ¶è–¬</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="immunosuppressant_mtx" onchange="updateProblems()"><span>ãƒ¡ãƒˆãƒˆãƒ¬ã‚­ã‚µãƒ¼ãƒˆ</span></label>
                <label class="checkbox-label"><input type="checkbox" id="immunosuppressant_mmf" onchange="updateProblems()"><span>ãƒŸã‚³ãƒ•ã‚§ãƒãƒ¼ãƒ«é…¸</span></label>
                <label class="checkbox-label"><input type="checkbox" id="immunosuppressant_cyclophosphamide" onchange="updateProblems()"><span>ã‚·ã‚¯ãƒ­ãƒ›ã‚¹ãƒ•ã‚¡ãƒŸãƒ‰</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" style="color: #9a3412; font-weight: 600;">ãã®ä»–</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="antihypertensive_acei" onchange="updateProblems()"><span>ACEé˜»å®³è–¬</span></label>
                <label class="checkbox-label"><input type="checkbox" id="antihypertensive_arb" onchange="updateProblems()"><span>ARB</span></label>
                <label class="checkbox-label"><input type="checkbox" id="anticoagulant_warfarin" onchange="updateProblems()"><span>ãƒ¯ãƒ«ãƒ•ã‚¡ãƒªãƒ³</span></label>
                <label class="checkbox-label"><input type="checkbox" id="thyroid_thiamazole" onchange="updateProblems()"><span>ãƒã‚¢ãƒã‚¾ãƒ¼ãƒ«</span></label>
                <label class="checkbox-label"><input type="checkbox" id="psychiatricMeds" onchange="updateProblems()"><span>ç²¾ç¥ç§‘è–¬å†…æœä¸­</span></label>
              </div>
            </div>
          </div>
        </div>

        <!-- ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('allergy')">
            <span class="section-title">4. ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</span>
            <span id="arrow-allergy">â–¼</span>
          </div>
          <div class="section-content" id="content-allergy">
            <div class="alert-box alert-orange">âš ï¸ åŒ»ç™‚è¡Œç‚ºã§æ³¨æ„ã™ã¹ãã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</div>
            <div class="form-group">
              <label class="form-label" style="color: #991b1b; font-weight: 600;">é«˜ãƒªã‚¹ã‚¯ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="allergy_latex" onchange="updateProblems()"><span>ãƒ©ãƒ†ãƒƒã‚¯ã‚¹(å¤©ç„¶ã‚´ãƒ )</span></label>
                <label class="checkbox-label"><input type="checkbox" id="allergy_chlorhexidine" onchange="updateProblems()"><span>ã‚¯ãƒ­ãƒ«ãƒ˜ã‚­ã‚·ã‚¸ãƒ³</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" style="color: #9a3412; font-weight: 600;">æŠ—èŒè–¬ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="allergy_penicillin" onchange="updateProblems()"><span>ãƒšãƒ‹ã‚·ãƒªãƒ³ç³»</span></label>
                <label class="checkbox-label"><input type="checkbox" id="allergy_cephalosporin" onchange="updateProblems()"><span>ã‚»ãƒ•ã‚§ãƒ ç³»</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" style="color: #9a3412; font-weight: 600;">ãã®ä»–</label>
              <div class="checkbox-group">
                <label class="checkbox-label"><input type="checkbox" id="allergy_localanesthetic" onchange="updateProblems()"><span>å±€æ‰€éº»é…”è–¬</span></label>
                <label class="checkbox-label"><input type="checkbox" id="allergy_nsaids" onchange="updateProblems()"><span>NSAIDs</span></label>
              </div>
            </div>
          </div>
        </div>

        <!-- æ„ŸæŸ“ç—‡ -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('infection')">
            <span class="section-title">5. æ„ŸæŸ“ç—‡</span>
            <span id="arrow-infection">â–¼</span>
          </div>
          <div class="section-content" id="content-infection">
            <div class="grid-2">
              <div class="form-group">
                <label class="form-label">æ¢…æ¯’(TPHA)</label>
                <select class="form-input" id="syphilis_tpha" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">æ¢…æ¯’(RPR)</label>
                <select class="form-input" id="syphilis_rpr" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">HBs-Ag</label>
                <select class="form-input" id="hbsag" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">HCV-Ab</label>
                <select class="form-input" id="hcv" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">HIV-Ab</label>
                <select class="form-input" id="hiv" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">é¢¨ç–¹(HI)</label>
                <select class="form-input" id="rubella" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="2">2å€</option>
                  <option value="4">4å€</option>
                  <option value="8">8å€</option>
                  <option value="16">16å€</option>
                  <option value="32">32å€</option>
                  <option value="64">64å€</option>
                  <option value="128">128å€</option>
                  <option value="256">256å€</option>
                  <option value="512">512å€<</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">HTLV-1-Ab</label>
                <select class="form-input" id="htlv1" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">ãƒˆã‚­ã‚½ãƒ—ãƒ©ã‚ºãƒ(IgM)</label>
                <select class="form-input" id="toxoplasma_igm" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">ã‚µã‚¤ãƒˆãƒ¡ã‚¬ãƒ­(IgM)</label>
                <select class="form-input" id="cmv_igm" onchange="updateProblems()">
                  <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="checkbox-label"><input type="checkbox" id="gbsPositive" onchange="updateProblems()"><span>GBSé™½æ€§</span></label>
            </div>
          </div>
        </div>

        <!-- ç”Ÿæ´»ãƒ»ç¤¾ä¼šèƒŒæ™¯ -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('social')">
            <span class="section-title">6. ç”Ÿæ´»ãƒ»ç¤¾ä¼šèƒŒæ™¯</span>
            <span id="arrow-social">â–¼</span>
          </div>
          <div class="section-content" id="content-social">
            <div class="form-group">
              <label class="form-label">æ‚£è€…éƒµä¾¿ç•ªå·</label>
              <div class="flex-gap">
                <input type="text" class="form-input" id="postalCode" placeholder="ä¾‹: 0600001" maxlength="8" style="max-width: 200px;">
                <button class="btn btn-primary" id="calcBtn" onclick="calculateTravelTime()">è‡ªå‹•è¨ˆç®—</button>
              </div>
              <p class="help-text">ç—…é™¢: ã€’007-8505 (æœ­å¹Œå¸‚æ±åŒºæ±è‹—ç©‚5æ¡1ä¸ç›®)</p>
            </div>
            <div class="form-group">
              <label class="form-label">è»Šã§ã®æ‰€è¦æ™‚é–“</label>
              <select class="form-input" id="travelTime" onchange="updateProblems()" style="max-width: 250px;">
                <option value="">---ï¼ˆæœªè¨­å®šï¼‰</option>
                <option value="10åˆ†ä»¥å†…">10åˆ†ä»¥å†…</option>
                <option value="20åˆ†ä»¥å†…">20åˆ†ä»¥å†…</option>
                <option value="30åˆ†ä»¥å†…">30åˆ†ä»¥å†…</option>
                <option value="40åˆ†ä»¥å†…">40åˆ†ä»¥å†…</option>
                <option value="50åˆ†ä»¥å†…">50åˆ†ä»¥å†…</option>
                <option value="60åˆ†ä»¥ä¸Š">60åˆ†ä»¥ä¸Š</option>
              </select>
              <p class="help-text" id="travelDetail" style="margin-top: 4px; color: #6b7280;">è‡ªå‹•è¨ˆç®—å¾Œã€æ‰‹å‹•ã§å¤‰æ›´ã‚‚å¯èƒ½ã§ã™</p>
            </div>
            <div class="form-group">
              <label class="form-label">å®¶æ—ã‚µãƒãƒ¼ãƒˆ</label>
              <div class="radio-group">
                <label class="radio-label"><input type="radio" name="familySupport" value="ååˆ†" onchange="updateProblems()"><span>ååˆ†</span></label>
                <label class="radio-label"><input type="radio" name="familySupport" value="ä¸€éƒ¨" onchange="updateProblems()"><span>ä¸€éƒ¨</span></label>
                <label class="radio-label"><input type="radio" name="familySupport" value="ã»ã¼ãªã—" onchange="updateProblems()"><span>ã»ã¼ãªã—</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</label>
              <div class="radio-group">
                <label class="radio-label"><input type="radio" name="partner" value="ã‚ã‚Š" checked onchange="updateProblems()"><span>ã‚ã‚Š</span></label>
                <label class="radio-label"><input type="radio" name="partner" value="åˆ¥å±…" onchange="updateProblems()"><span>åˆ¥å±…</span></label>
                <label class="radio-label"><input type="radio" name="partner" value="ãªã—" onchange="updateProblems()"><span>ãªã—</span></label>
              </div>
            </div>
            <div class="form-group">
              <label class="checkbox-label"><input type="checkbox" id="married" checked onchange="updateProblems()"><span>æ—¢å©š</span></label>
            </div>
            <div class="form-group">
              <label class="form-label">ä¸Šã®å­ã®é ã‘å…ˆ</label>
              <div class="radio-group">
                <label class="radio-label"><input type="radio" name="childCare" value="æ±ºã¾ã£ã¦ã„ã‚‹" checked onchange="updateProblems()"><span>æ±ºã¾ã£ã¦ã„ã‚‹</span></label>
                <label class="radio-label"><input type="radio" name="childCare" value="æœªå®š" onchange="updateProblems()"><span>æœªå®š</span></label>
              </div>
            </div>
          </div>
        </div>

        <!-- ç”Ÿæ´»ç¿’æ…£ -->
        <div class="form-section">
          <div class="section-header" onclick="toggleSection('lifestyle')">
            <span class="section-title">7. ç”Ÿæ´»ç¿’æ…£</span>
            <span id="arrow-lifestyle">â–¼</span>
          </div>
          <div class="section-content" id="content-lifestyle">
            <div class="checkbox-group">
              <label class="checkbox-label"><input type="checkbox" id="smoking" onchange="updateProblems()"><span>å–«ç…™(æœ¬äººã¾ãŸã¯åŒå±…å®¶æ—)</span></label>
              <label class="checkbox-label"><input type="checkbox" id="alcohol" onchange="updateProblems()"><span>é£²é…’</span></label>
            </div>
          </div>
        </div>

      </div>

      <!-- ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãƒªã‚¹ãƒˆ -->
      <div>
        <div class="problem-list">
          <h2>
            ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãƒªã‚¹ãƒˆ
            <button class="btn btn-primary" onclick="copyProblems()" style="padding: 6px 12px; font-size: 12px;">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
          </h2>
          <div id="problemList">
            <p style="color: #6b7280; font-size: 13px;">ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãªã—</p>
          </div>
          <div class="legend">
            <h3 style="font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 6px;">å‡¡ä¾‹</h3>
            <div class="legend-item">
              <div class="legend-box" style="background: #fca5a5; border-color: #fca5a5;"></div>
              <span>é«˜ãƒªã‚¹ã‚¯</span>
            </div>
            <div class="legend-item">
              <div class="legend-box" style="background: #fcd34d; border-color: #fcd34d;"></div>
              <span>ä¸­ãƒªã‚¹ã‚¯</span>
            </div>
            <div class="legend-item">
              <div class="legend-box" style="background: #93c5fd; border-color: #93c5fd;"></div>
              <span>æ³¨æ„äº‹é …</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // éƒµä¾¿ç•ªå·ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆæœ­å¹Œå¸‚å†…ä¸»è¦ã‚¨ãƒªã‚¢ï¼‰
    const postalCodeDB = {
      // æœ­å¹Œå¸‚ä¸­å¤®åŒº
      '0600001': { lat: 43.0642, lon: 141.3469 },
      '0600002': { lat: 43.0656, lon: 141.3511 },
      '0600003': { lat: 43.0669, lon: 141.3553 },
      '0600004': { lat: 43.0683, lon: 141.3594 },
      '0600005': { lat: 43.0697, lon: 141.3636 },
      '0600006': { lat: 43.0711, lon: 141.3678 },
      '0600007': { lat: 43.0725, lon: 141.3719 },
      '0600008': { lat: 43.0739, lon: 141.3761 },
      '0600009': { lat: 43.0753, lon: 141.3803 },
      '0600031': { lat: 43.0850, lon: 141.3344 },
      '0600032': { lat: 43.0864, lon: 141.3386 },
      '0600033': { lat: 43.0878, lon: 141.3428 },
      '0600034': { lat: 43.0892, lon: 141.3469 },
      '0600035': { lat: 43.0906, lon: 141.3511 },
      '0600041': { lat: 43.0586, lon: 141.3344 },
      '0600042': { lat: 43.0600, lon: 141.3386 },
      '0600043': { lat: 43.0614, lon: 141.3428 },
      '0600044': { lat: 43.0628, lon: 141.3469 },
      '0600045': { lat: 43.0642, lon: 141.3511 },
      
      // æœ­å¹Œå¸‚åŒ—åŒº
      '0010010': { lat: 43.0867, lon: 141.3344 },
      '0010011': { lat: 43.0881, lon: 141.3386 },
      '0010012': { lat: 43.0894, lon: 141.3428 },
      '0010013': { lat: 43.0908, lon: 141.3469 },
      '0010014': { lat: 43.0928, lon: 141.3572 },
      '0010015': { lat: 43.0944, lon: 141.3614 },
      '0010016': { lat: 43.0961, lon: 141.3656 },
      '0010017': { lat: 43.0978, lon: 141.3697 },
      '0010020': { lat: 43.1011, lon: 141.3781 },
      '0010021': { lat: 43.1028, lon: 141.3822 },
      '0010911': { lat: 43.1236, lon: 141.3656 },
      '0010912': { lat: 43.1250, lon: 141.3697 },
      '0010913': { lat: 43.1264, lon: 141.3739 },
      '0010914': { lat: 43.1278, lon: 141.3781 },
      '0010915': { lat: 43.1292, lon: 141.3822 },
      
      // æœ­å¹Œå¸‚æ±åŒº
      '0640801': { lat: 43.0789, lon: 141.3828 },
      '0640802': { lat: 43.0803, lon: 141.3869 },
      '0640803': { lat: 43.0817, lon: 141.3911 },
      '0640804': { lat: 43.0831, lon: 141.3953 },
      '0640805': { lat: 43.0844, lon: 141.3994 },
      '0640806': { lat: 43.0858, lon: 141.4036 },
      '0640807': { lat: 43.0872, lon: 141.4078 },
      '0640808': { lat: 43.0886, lon: 141.4119 },
      '0640809': { lat: 43.0900, lon: 141.4161 },
      '0640810': { lat: 43.0914, lon: 141.4203 },
      '0640820': { lat: 43.0942, lon: 141.4286 },
      '0640921': { lat: 43.0917, lon: 141.4450 },
      '0640922': { lat: 43.0931, lon: 141.4492 },
      '0640923': { lat: 43.0944, lon: 141.4533 },
      '0640924': { lat: 43.0958, lon: 141.4575 },
      '0640925': { lat: 43.0972, lon: 141.4617 },
      '0640941': { lat: 43.1014, lon: 141.4700 },
      '0640942': { lat: 43.1028, lon: 141.4742 },
      '0640943': { lat: 43.1042, lon: 141.4783 },
      '0640944': { lat: 43.1056, lon: 141.4825 },
      '0640945': { lat: 43.1069, lon: 141.4867 },
      '0640951': { lat: 43.1097, lon: 141.4950 },
      '0640952': { lat: 43.1111, lon: 141.4992 },
      '0640953': { lat: 43.1125, lon: 141.5033 },
      '0640954': { lat: 43.1139, lon: 141.5075 },
      
      // æœ­å¹Œå¸‚ç™½çŸ³åŒº
      '0030001': { lat: 43.0492, lon: 141.4039 },
      '0030002': { lat: 43.0506, lon: 141.4081 },
      '0030003': { lat: 43.0519, lon: 141.4122 },
      '0030004': { lat: 43.0533, lon: 141.4164 },
      '0030005': { lat: 43.0547, lon: 141.4206 },
      '0030021': { lat: 43.0603, lon: 141.4331 },
      '0030022': { lat: 43.0617, lon: 141.4372 },
      '0030023': { lat: 43.0631, lon: 141.4414 },
      '0030024': { lat: 43.0644, lon: 141.4456 },
      '0030025': { lat: 43.0658, lon: 141.4497 },
      
      // æœ­å¹Œå¸‚è±Šå¹³åŒº
      '0040001': { lat: 43.0311, lon: 141.3828 },
      '0040002': { lat: 43.0325, lon: 141.3869 },
      '0040003': { lat: 43.0339, lon: 141.3911 },
      '0040004': { lat: 43.0353, lon: 141.3953 },
      '0040005': { lat: 43.0367, lon: 141.3994 },
      '0040021': { lat: 43.0422, lon: 141.4119 },
      '0040022': { lat: 43.0436, lon: 141.4161 },
      '0040023': { lat: 43.0450, lon: 141.4203 },
      '0040024': { lat: 43.0464, lon: 141.4244 },
      '0040025': { lat: 43.0478, lon: 141.4286 },
      '0040073': { lat: 43.0381, lon: 141.3703 },
      
      // æœ­å¹Œå¸‚è¥¿åŒº
      '0630801': { lat: 43.0728, lon: 141.2742 },
      '0630802': { lat: 43.0742, lon: 141.2783 },
      '0630803': { lat: 43.0756, lon: 141.2825 },
      '0630804': { lat: 43.0769, lon: 141.2867 },
      '0630805': { lat: 43.0783, lon: 141.2908 },
      
      // æœ­å¹Œå¸‚æ‰‹ç¨²åŒº
      '0060001': { lat: 43.1364, lon: 141.2450 },
      '0060002': { lat: 43.1378, lon: 141.2492 },
      '0060003': { lat: 43.1392, lon: 141.2533 },
      '0060011': { lat: 43.1475, lon: 141.2700 },
      '0060012': { lat: 43.1489, lon: 141.2742 },
      
      // æœ­å¹Œå¸‚åšåˆ¥åŒº
      '0040061': { lat: 43.0297, lon: 141.4828 },
      '0040062': { lat: 43.0311, lon: 141.4869 },
      '0040063': { lat: 43.0325, lon: 141.4911 },
      '0040064': { lat: 43.0339, lon: 141.4953 },
      '0040065': { lat: 43.0353, lon: 141.4994 },
      
      // æœ­å¹Œå¸‚æ¸…ç”°åŒº
      '0040801': { lat: 42.9978, lon: 141.4450 },
      '0040802': { lat: 42.9992, lon: 141.4492 },
      '0040803': { lat: 43.0006, lon: 141.4533 },
      '0040804': { lat: 43.0019, lon: 141.4575 },
      '0040805': { lat: 43.0033, lon: 141.4617 },
      
      // æœ­å¹Œå¸‚å—åŒº
      '0050001': { lat: 42.9944, lon: 141.3428 },
      '0050002': { lat: 42.9958, lon: 141.3469 },
      '0050003': { lat: 42.9972, lon: 141.3511 },
      '0050004': { lat: 42.9986, lon: 141.3553 },
      '0050005': { lat: 43.0000, lon: 141.3594 },
      '0620031': { lat: 43.0394, lon: 141.3011 },
      '0620032': { lat: 43.0408, lon: 141.3053 },
      '0620033': { lat: 43.0422, lon: 141.3094 },
      '0613776': { lat: 42.8819, lon: 141.2450 }
    };

    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹é–‰
    function toggleSection(section) {
      const content = document.getElementById('content-' + section);
      const arrow = document.getElementById('arrow-' + section);
      if (content.classList.contains('expanded')) {
        content.classList.remove('expanded');
        arrow.textContent = 'â–¶';
      } else {
        content.classList.add('expanded');
        arrow.textContent = 'â–¼';
      }
    }

    // BMIè¨ˆç®—
    function calculateBMI() {
      const height = parseFloat(document.getElementById('height').value);
      const weight = parseFloat(document.getElementById('preWeight').value);
      if (height && weight) {
        const bmi = weight / ((height / 100) ** 2);
        document.getElementById('bmiDisplay').textContent = bmi.toFixed(1);
        return bmi;
      }
      document.getElementById('bmiDisplay').textContent = '---';
      return null;
    }

    // éƒµä¾¿ç•ªå·ã‹ã‚‰æ‰€è¦æ™‚é–“ã‚’è¨ˆç®—
    async function calculateTravelTime() {
      const code = document.getElementById('postalCode').value.replace(/[^0-9]/g, '');
      
      if (code.length !== 7) {
        alert('éƒµä¾¿ç•ªå·ã¯7æ¡ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      const btn = document.getElementById('calcBtn');
      btn.disabled = true;
      btn.textContent = 'è¨ˆç®—ä¸­...';

      try {
        // ç—…é™¢ã®åº§æ¨™
        const hospitalLat = 43.0992;
        const hospitalLon = 141.4292;

        // éƒµä¾¿ç•ªå·ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰åº§æ¨™ã‚’å–å¾—
        const patientCoords = postalCodeDB[code];
        
        if (!patientCoords) {
          alert(`éƒµä¾¿ç•ªå· ${code} ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\næœ­å¹Œå¸‚å†…ã®ä¸»è¦ãªéƒµä¾¿ç•ªå·ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚\næ‰‹å‹•ã§é¸æŠã—ã¦ãã ã•ã„ã€‚`);
          btn.disabled = false;
          btn.textContent = 'è‡ªå‹•è¨ˆç®—';
          return;
        }

        // OSRMã§å®Ÿéš›ã®ãƒ«ãƒ¼ãƒˆè¨ˆç®—
        const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${patientCoords.lon},${patientCoords.lat};${hospitalLon},${hospitalLat}?overview=false`;
        
        const res = await fetch(osrmUrl);
        if (!res.ok) throw new Error('OSRM API error');
        
        const data = await res.json();
        
        if (data.code !== 'Ok' || !data.routes || data.routes.length === 0) {
          throw new Error('No route found');
        }

        // æ‰€è¦æ™‚é–“ï¼ˆç§’ï¼‰ã¨è·é›¢ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰ã‚’å–å¾—
        const durationSeconds = data.routes[0].duration;
        const distanceMeters = data.routes[0].distance;
        const distanceKm = distanceMeters / 1000;
        
        // æœ­å¹Œå¸‚å†…ã®å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿ï¼ˆiPhone ãƒãƒƒãƒ—ï¼‰ã«åŸºã¥ãè·é›¢å¸¯åˆ¥è£œæ­£ä¿‚æ•°
        // Apple Mapsã¨åŒç­‰ã®ç²¾åº¦ã‚’å®Ÿç¾
        let CORRECTION_FACTOR;
        if (distanceKm < 6) {
          // å¸‚è¡—åœ°è¿‘è·é›¢: ä¿¡å·ãƒ»æ¸‹æ»ãŒå¤šã„
          CORRECTION_FACTOR = 3.0;
        } else if (distanceKm < 10) {
          // ä¸­è·é›¢: ä¸€èˆ¬é“ä¸­å¿ƒ
          CORRECTION_FACTOR = 2.7;
        } else if (distanceKm < 15) {
          // ä¸­è·é›¢ã€œé è·é›¢: å¹¹ç·šé“è·¯æ··åœ¨
          CORRECTION_FACTOR = 2.3;
        } else {
          // é è·é›¢: å¹¹ç·šé“è·¯ãƒ»é«˜é€Ÿåˆ©ç”¨å¯èƒ½æ€§
          CORRECTION_FACTOR = 1.8;
        }
        
        const rawMinutes = durationSeconds / 60;
        const minutes = Math.round(rawMinutes * CORRECTION_FACTOR);

        // æ™‚é–“ã‚’åˆ†é¡
        let category;
        if (minutes <= 10) category = '10åˆ†ä»¥å†…';
        else if (minutes <= 20) category = '20åˆ†ä»¥å†…';
        else if (minutes <= 30) category = '30åˆ†ä»¥å†…';
        else if (minutes <= 40) category = '40åˆ†ä»¥å†…';
        else if (minutes <= 50) category = '50åˆ†ä»¥å†…';
        else category = '60åˆ†ä»¥ä¸Š';

        // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«è‡ªå‹•è¨­å®š
        document.getElementById('travelTime').value = category;
        
        // è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
        document.getElementById('travelDetail').textContent = 
          `å®Ÿè·é›¢: ${distanceKm.toFixed(1)}km / æ¨å®š: ${minutes}åˆ†ï¼ˆè‡ªå‹•è¨ˆç®—çµæœãƒ»æ‰‹å‹•å¤‰æ›´å¯ï¼‰`;
        document.getElementById('travelDetail').style.color = '#3b82f6';
        
        updateProblems();

      } catch (e) {
        console.error('Travel time calculation error:', e);
        alert('ç§»å‹•æ™‚é–“ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æ‰‹å‹•ã§é¸æŠã—ã¦ãã ã•ã„ã€‚\nã‚¨ãƒ©ãƒ¼: ' + e.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'è‡ªå‹•è¨ˆç®—';
      }
    }

    // ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ æŠ½å‡º
    function updateProblems() {
      calculateBMI();
      const problems = [];
      const bmi = calculateBMI();

      // é«˜ãƒªã‚¹ã‚¯ï¼ˆèµ¤ï¼‰
      if (document.getElementById('prevAdhesion').checked || 
          (parseInt(document.getElementById('cesarean').value) > 0 && document.getElementById('prevPlacenta').checked)) {
        problems.push({ text: '#ç™’ç€èƒç›¤æ³¨æ„', level: 'high' });
      }
      if (document.getElementById('prevHDP').checked) problems.push({ text: '#å‰å›HDP', level: 'high' });
      if (document.getElementById('prevPreterm').checked) problems.push({ text: '#å‰å›æ—©ç”£', level: 'high' });
      if (document.getElementById('prevPPH').checked) problems.push({ text: '#å‰å›ç”£å¾Œå‡ºè¡€', level: 'high' });
      if (document.getElementById('thrombosis').checked) problems.push({ text: '#è¡€æ “ç—‡æ—¢å¾€', level: 'high' });
      if (document.getElementById('autoimmune').checked) problems.push({ text: '#è‡ªå·±å…ç–«ç–¾æ‚£', level: 'high' });
      if (document.getElementById('diabetes').checked) problems.push({ text: '#ç³–å°¿ç—…åˆä½µ', level: 'high' });

      // å‚¬å¥‡å½¢æ€§è–¬å‰¤ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰
      if (document.getElementById('aed_valproate').checked) problems.push({ text: '#ãƒãƒ«ãƒ—ãƒ­é…¸å†…æœä¸­', level: 'high' });
      if (document.getElementById('retinoid_isotretinoin').checked || document.getElementById('retinoid_acitretin').checked) {
        problems.push({ text: '#ãƒ¬ãƒãƒã‚¤ãƒ‰å†…æœä¸­(çµ¶å¯¾ç¦å¿Œ)', level: 'high' });
      }
      if (document.getElementById('immunosuppressant_mtx').checked) problems.push({ text: '#ãƒ¡ãƒˆãƒˆãƒ¬ã‚­ã‚µãƒ¼ãƒˆå†…æœä¸­(ç¦å¿Œ)', level: 'high' });
      if (document.getElementById('immunosuppressant_mmf').checked || document.getElementById('immunosuppressant_cyclophosphamide').checked) {
        problems.push({ text: '#å…ç–«æŠ‘åˆ¶è–¬å†…æœä¸­(ç¦å¿Œ)', level: 'high' });
      }
      if (document.getElementById('anticoagulant_warfarin').checked) problems.push({ text: '#ãƒ¯ãƒ«ãƒ•ã‚¡ãƒªãƒ³å†…æœä¸­(è¦å¤‰æ›´)', level: 'high' });

      // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰
      if (document.getElementById('allergy_latex').checked) problems.push({ text: '#ãƒ©ãƒ†ãƒƒã‚¯ã‚¹ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'high' });
      if (document.getElementById('allergy_chlorhexidine').checked) problems.push({ text: '#ã‚¯ãƒ­ãƒ«ãƒ˜ã‚­ã‚·ã‚¸ãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'high' });

      // æ„ŸæŸ“ç—‡ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰
      if (document.getElementById('syphilis_tpha').value === 'é™½æ€§' || document.getElementById('syphilis_rpr').value === 'é™½æ€§') {
        problems.push({ text: '#æ¢…æ¯’é™½æ€§', level: 'high' });
      }
      if (document.getElementById('hbsag').value === 'é™½æ€§') problems.push({ text: '#HBsæŠ—åŸé™½æ€§', level: 'high' });
      if (document.getElementById('hcv').value === 'é™½æ€§') problems.push({ text: '#HCVæŠ—ä½“é™½æ€§', level: 'high' });
      if (document.getElementById('hiv').value === 'é™½æ€§') problems.push({ text: '#HIVæŠ—ä½“é™½æ€§', level: 'high' });
      if (document.getElementById('toxoplasma_igm').value === 'é™½æ€§') problems.push({ text: '#ãƒˆã‚­ã‚½ãƒ—ãƒ©ã‚ºãƒIgMé™½æ€§', level: 'high' });

      // ä¸­ãƒªã‚¹ã‚¯ï¼ˆé»„ï¼‰
      const age = parseInt(document.getElementById('age').value);
      if (age >= 35) problems.push({ text: '#é«˜é½¢å¦Šå¨ ', level: 'medium' });
      if (bmi >= 25) problems.push({ text: '#è‚¥æº€', level: 'medium' });
      if (bmi < 18.5) problems.push({ text: '#ã‚„ã›', level: 'medium' });
      if (parseInt(document.getElementById('cesarean').value) > 0) problems.push({ text: '#æ—¢å¾€å¸ç‹åˆ‡é–‹', level: 'medium' });
      if (document.getElementById('lastDeliveryWithin1Year').checked) problems.push({ text: '#å‰å›å¦Šå¨ ã‹ã‚‰1å¹´æœªæº€ã®å¦Šå¨ ', level: 'medium' });
      if (document.getElementById('prevGDM').checked) problems.push({ text: '#å‰å›GDM', level: 'medium' });
      if (document.getElementById('psychiatricMeds').checked) problems.push({ text: '#ç²¾ç¥ç§‘è–¬å†…æœä¸­', level: 'medium' });

      // å‚¬å¥‡å½¢æ€§è–¬å‰¤ï¼ˆä¸­ãƒªã‚¹ã‚¯ï¼‰
      if (document.getElementById('aed_carbamazepine').checked || document.getElementById('aed_phenytoin').checked || document.getElementById('aed_other').checked) {
        problems.push({ text: '#æŠ—ã¦ã‚“ã‹ã‚“è–¬å†…æœä¸­', level: 'medium' });
      }
      if (document.getElementById('antihypertensive_acei').checked || document.getElementById('antihypertensive_arb').checked) {
        problems.push({ text: '#ACEé˜»å®³è–¬/ARBå†…æœä¸­(è¦å¤‰æ›´)', level: 'medium' });
      }
      if (document.getElementById('thyroid_thiamazole').checked) problems.push({ text: '#ãƒã‚¢ãƒã‚¾ãƒ¼ãƒ«å†…æœä¸­(è¦æ³¨æ„)', level: 'medium' });

      // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ï¼ˆä¸­ãƒªã‚¹ã‚¯ï¼‰
      if (document.getElementById('allergy_penicillin').checked) problems.push({ text: '#ãƒšãƒ‹ã‚·ãƒªãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'medium' });
      if (document.getElementById('allergy_cephalosporin').checked) problems.push({ text: '#ã‚»ãƒ•ã‚§ãƒ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'medium' });
      if (document.getElementById('allergy_localanesthetic').checked) problems.push({ text: '#å±€æ‰€éº»é…”è–¬ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'medium' });

      // æ—¢å¾€æ­´ï¼ˆä¸­ãƒªã‚¹ã‚¯ï¼‰
      if (document.getElementById('hypertension').checked) problems.push({ text: '#é«˜è¡€åœ§åˆä½µ', level: 'medium' });
      if (document.getElementById('thyroid').checked) problems.push({ text: '#ç”²çŠ¶è…ºç–¾æ‚£', level: 'medium' });
      if (document.getElementById('abdominalSurgery').checked) problems.push({ text: '#è…¹éƒ¨æ—¢å¾€æ‰‹è¡“ã‚ã‚Š', level: 'medium' });
      if (document.getElementById('uterineAnomaly').checked) problems.push({ text: '#å­å®®å¥‡å½¢', level: 'medium' });
      if (document.getElementById('cervicalSurgery').checked) problems.push({ text: '#é ¸ç®¡æ‰‹è¡“æ—¢å¾€', level: 'medium' });

      // æ„ŸæŸ“ç—‡ï¼ˆä¸­ãƒªã‚¹ã‚¯ï¼‰
      if (document.getElementById('htlv1').value === 'é™½æ€§') problems.push({ text: '#HTLV-1æŠ—ä½“é™½æ€§', level: 'medium' });
      if (document.getElementById('cmv_igm').value === 'é™½æ€§') problems.push({ text: '#ã‚µã‚¤ãƒˆãƒ¡ã‚¬ãƒ­IgMé™½æ€§', level: 'medium' });

      // ä½ãƒªã‚¹ã‚¯/æ³¨æ„ï¼ˆé’ï¼‰
      const rubella = parseInt(document.getElementById('rubella').value);
      if (rubella && rubella < 16) problems.push({ text: '#é¢¨ç–¹æŠ—ä½“ä½å€¤', level: 'low' });
      if (document.getElementById('gbsPositive').checked) problems.push({ text: '#GBSé™½æ€§', level: 'low' });

      const travelTime = document.getElementById('travelTime').value;
      if (travelTime === '50åˆ†ä»¥å†…' || travelTime === '60åˆ†ä»¥ä¸Š') problems.push({ text: '#é æ–¹åœ¨ä½', level: 'low' });

      const familySupport = document.querySelector('input[name="familySupport"]:checked');
      if (familySupport && familySupport.value === 'ã»ã¼ãªã—') problems.push({ text: '#å®¶æ—æ”¯æ´ãªã—', level: 'low' });

      const childCare = document.querySelector('input[name="childCare"]:checked');
      if (childCare && childCare.value === 'æœªå®š') problems.push({ text: '#ä¸Šã®å­é ã‘å…ˆæœªå®š', level: 'low' });

      if (document.getElementById('prevRapidLabor').checked) problems.push({ text: '#å‰å›åˆ†å¨©çµŒéæ—©ã„', level: 'low' });
      if (document.getElementById('prevPROM').checked) problems.push({ text: '#å‰å›å‰æœŸç ´æ°´', level: 'low' });
      if (parseInt(document.getElementById('para').value) === 0) problems.push({ text: '#åˆç”£', level: 'low' });
      if (!document.getElementById('married').checked) problems.push({ text: '#æœªå©š', level: 'low' });

      const partner = document.querySelector('input[name="partner"]:checked');
      if (partner && (partner.value === 'åˆ¥å±…' || partner.value === 'ãªã—')) problems.push({ text: '#å¤«ãŒåˆ¥', level: 'low' });

      if (document.getElementById('smoking').checked) problems.push({ text: '#å–«ç…™', level: 'low' });
      if (document.getElementById('allergy_nsaids').checked) problems.push({ text: '#NSAIDsã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'low' });

      // è¡¨ç¤º
      const listDiv = document.getElementById('problemList');
      if (problems.length === 0) {
        listDiv.innerHTML = '<p style="color: #6b7280; font-size: 13px;">ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãªã—</p>';
      } else {
        listDiv.innerHTML = problems.map(p => 
          `<div class="problem-item problem-${p.level}">${p.text}</div>`
        ).join('');
      }
    }

    // ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ã‚’ã‚³ãƒ”ãƒ¼
    function copyProblems() {
      const items = document.querySelectorAll('.problem-item');
      if (items.length === 0) {
        alert('ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãŒã‚ã‚Šã¾ã›ã‚“');
        return;
      }
      const text = Array.from(items).map(item => item.textContent).join(', ');
      navigator.clipboard.writeText(text).then(() => {
        alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
      });
    }

    // ãƒªã‚»ãƒƒãƒˆ
    function resetForm() {
      if (!confirm('å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹?')) return;
      document.querySelectorAll('input[type="text"], input[type="number"], textarea, select').forEach(el => {
        el.value = '';
      });
      document.querySelectorAll('input[type="checkbox"]').forEach(el => {
        el.checked = el.id === 'married';
      });
      document.querySelectorAll('input[type="radio"]').forEach(el => {
        if (el.value === 'ã‚ã‚Š' && el.name === 'partner') el.checked = true;
        else if (el.value === 'æ±ºã¾ã£ã¦ã„ã‚‹' && el.name === 'childCare') el.checked = true;
        else el.checked = false;
      });
      document.getElementById('bmiDisplay').textContent = '---';
      document.getElementById('travelTime').value = '';
      document.getElementById('travelDetail').textContent = 'è‡ªå‹•è¨ˆç®—å¾Œã€æ‰‹å‹•ã§å¤‰æ›´ã‚‚å¯èƒ½ã§ã™';
      document.getElementById('travelDetail').style.color = '#6b7280';
      updateProblems();
    }

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      updateProblems();
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ç”£ç§‘ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ">
  <title>ç”£ç§‘å•è¨ºãƒ—ãƒ­ãƒ–ãƒ¬ãƒ æŠ½å‡º</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f3f4f6; min-height: 100vh; -webkit-text-size-adjust: 100%; }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
    .header { background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
    .header h1 { font-size: 18px; color: #1f2937; display: flex; align-items: center; gap: 8px; }
    .btn { padding: 10px 16px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; }
    .btn-gray { background: #4b5563; color: white; }
    .btn-gray:active { background: #374151; }
    .btn-blue { background: #2563eb; color: white; }
    .btn-blue:active { background: #1d4ed8; }
    .btn-blue:disabled { background: #9ca3af; }
    .main-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 1024px) { .main-grid { grid-template-columns: 2fr 1fr; } }
    .section { background: white; border-radius: 12px; margin-bottom: 16px; overflow: hidden; border: 1px solid #e5e7eb; }
    .section-header { width: 100%; padding: 14px 16px; background: #f9fafb; border: none; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 15px; font-weight: 600; color: #374151; }
    .section-header:active { background: #f3f4f6; }
    .section-content { padding: 16px; display: none; }
    .section-content.open { display: block; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .form-group { margin-bottom: 12px; }
    .form-group label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 6px; color: #374151; }
    input[type="text"], input[type="number"], select, textarea { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; background: white; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #2563eb; }
    .readonly { background: #f3f4f6; }
    .checkbox-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
    .checkbox-item { display: flex; align-items: center; gap: 8px; padding: 8px 4px; }
    .checkbox-item input { width: 20px; height: 20px; }
    .checkbox-item span { font-size: 14px; }
    .radio-group { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 6px; }
    .radio-item { display: flex; align-items: center; gap: 6px; }
    .radio-item input { width: 20px; height: 20px; }
    .radio-item span { font-size: 14px; }
    .alert-box { padding: 10px 12px; border-left: 4px solid; border-radius: 4px; margin-bottom: 12px; font-size: 13px; font-weight: 600; }
    .alert-red { background: #fef2f2; border-color: #ef4444; color: #991b1b; }
    .alert-orange { background: #fff7ed; border-color: #f97316; color: #9a3412; }
    .subsection-title { font-size: 14px; font-weight: 600; margin: 12px 0 8px 0; }
    .subsection-title.red { color: #b91c1c; }
    .subsection-title.orange { color: #c2410c; }
    .postal-row { display: flex; gap: 8px; }
    .postal-row input { flex: 1; }
    .problem-panel { background: linear-gradient(135deg, #eff6ff 0%, #e0e7ff 100%); border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    @media (min-width: 1024px) { .problem-panel { position: sticky; top: 16px; } }
    .problem-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .problem-header h2 { font-size: 18px; color: #1f2937; }
    .problem-list { max-height: 400px; overflow-y: auto; }
    .problem-item { padding: 10px 12px; border-radius: 8px; margin-bottom: 8px; font-size: 14px; font-weight: 500; }
    .problem-high { background: #fee2e2; color: #991b1b; border: 2px solid #fca5a5; }
    .problem-medium { background: #fef9c3; color: #854d0e; border: 2px solid #fde047; }
    .problem-low { background: #dbeafe; color: #1e40af; border: 2px solid #93c5fd; }
    .legend { margin-top: 16px; padding-top: 16px; border-top: 1px solid #c7d2fe; }
    .legend h3 { font-size: 14px; color: #374151; margin-bottom: 8px; }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; margin-bottom: 4px; }
    .legend-box { width: 16px; height: 16px; border-radius: 4px; }
    .legend-box.high { background: #fecaca; border: 1px solid #fca5a5; }
    .legend-box.medium { background: #fef08a; border: 1px solid #fde047; }
    .legend-box.low { background: #bfdbfe; border: 1px solid #93c5fd; }
    .empty-message { color: #6b7280; font-size: 14px; padding: 16px 0; }
    .footer { text-align: center; font-size: 12px; color: #9ca3af; margin-top: 16px; }
    .divider { border-top: 1px solid #e5e7eb; margin: 12px 0; padding-top: 12px; }
    .hint { font-size: 12px; color: #6b7280; margin-top: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <h1>âš ï¸ ç”£ç§‘å•è¨ºãƒ—ãƒ­ãƒ–ãƒ¬ãƒ æŠ½å‡º</h1>
      <button class="btn btn-gray" onclick="resetForm()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="main-grid">
      <!-- å·¦ã‚«ãƒ©ãƒ : å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
      <div class="form-column">
        
        <!-- 0. åŸºæœ¬æƒ…å ± -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('basic')">
            <span>0. åŸºæœ¬æƒ…å ±</span>
            <span id="basic-icon">â–¼</span>
          </button>
          <div id="basic-content" class="section-content open">
            <div class="form-row">
              <div class="form-group">
                <label>å¹´é½¢</label>
                <input type="number" id="age" inputmode="numeric" placeholder="æ­³" onchange="updateProblems()">
              </div>
              <div class="form-group">
                <label>èº«é•· (cm)</label>
                <input type="number" id="height" inputmode="decimal" onchange="updateProblems()">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>å¦Šå¨ å‰ä½“é‡ (kg)</label>
                <input type="number" id="preWeight" inputmode="decimal" onchange="updateProblems()">
              </div>
              <div class="form-group">
                <label>BMI</label>
                <input type="text" id="bmi" class="readonly" readonly value="---">
              </div>
            </div>
            <div class="form-group">
              <label>ãã®ä»–</label>
              <textarea id="basicOther" rows="2" placeholder="è‡ªç”±è¨˜è¼‰"></textarea>
            </div>
          </div>
        </div>

        <!-- 1. ç”£ç§‘æ—¢å¾€ -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('obs')">
            <span>1. ç”£ç§‘æ—¢å¾€</span>
            <span id="obs-icon">â–²</span>
          </button>
          <div id="obs-content" class="section-content">
            <div class="form-row-3">
              <div class="form-group">
                <label>å¦Šå¨ å›æ•°(G)</label>
                <input type="number" id="gravida" inputmode="numeric" onchange="updateProblems()">
              </div>
              <div class="form-group">
                <label>åˆ†å¨©å›æ•°(P)</label>
                <input type="number" id="para" inputmode="numeric" onchange="updateProblems()">
              </div>
              <div class="form-group">
                <label>å¸ç‹åˆ‡é–‹</label>
                <input type="number" id="cesarean" inputmode="numeric" onchange="updateProblems()">
              </div>
            </div>
            <div class="divider">
              <label style="font-weight:500; font-size:14px;">å‰å›ãƒ»éå»å¦Šå¨ ã®åˆä½µç—‡</label>
              <div class="checkbox-grid" style="margin-top:8px;">
                <label class="checkbox-item"><input type="checkbox" id="prevGDM" onchange="updateProblems()"><span>GDM</span></label>
                <label class="checkbox-item"><input type="checkbox" id="prevHDP" onchange="updateProblems()"><span>å¦Šå¨ é«˜è¡€åœ§ç—‡å€™ç¾¤</span></label>
                <label class="checkbox-item"><input type="checkbox" id="prevPreterm" onchange="updateProblems()"><span>åˆ‡è¿«æ—©ç”£/æ—©ç”£</span></label>
                <label class="checkbox-item"><input type="checkbox" id="prevPlacenta" onchange="updateProblems()"><span>å‰ç½®/ä½ç½®èƒç›¤</span></label>
                <label class="checkbox-item"><input type="checkbox" id="prevPPH" onchange="updateProblems()"><span>ç”£å¾Œå‡ºè¡€</span></label>
                <label class="checkbox-item"><input type="checkbox" id="prevAdhesion" onchange="updateProblems()"><span>ç™’ç€èƒç›¤ç–‘ã„</span></label>
                <label class="checkbox-item"><input type="checkbox" id="prevRapidLabor" onchange="updateProblems()"><span>åˆ†å¨©çµŒéæ—©ã„</span></label>
                <label class="checkbox-item"><input type="checkbox" id="prevPROM" onchange="updateProblems()"><span>å‰æœŸç ´æ°´</span></label>
              </div>
            </div>
            <label class="checkbox-item"><input type="checkbox" id="lastDeliveryWithin1Year" onchange="updateProblems()"><span>å‰å›åˆ†å¨©ãŒ1å¹´æœªæº€</span></label>
          </div>
        </div>

        <!-- 2. æ—¢å¾€æ­´ -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('medical')">
            <span>2. æ—¢å¾€æ­´</span>
            <span id="medical-icon">â–²</span>
          </button>
          <div id="medical-content" class="section-content">
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="hypertension" onchange="updateProblems()"><span>é«˜è¡€åœ§</span></label>
              <label class="checkbox-item"><input type="checkbox" id="diabetes" onchange="updateProblems()"><span>ç³–å°¿ç—…</span></label>
              <label class="checkbox-item"><input type="checkbox" id="thyroid" onchange="updateProblems()"><span>ç”²çŠ¶è…ºç–¾æ‚£</span></label>
              <label class="checkbox-item"><input type="checkbox" id="autoimmune" onchange="updateProblems()"><span>è‡ªå·±å…ç–«ç–¾æ‚£</span></label>
              <label class="checkbox-item"><input type="checkbox" id="thrombosis" onchange="updateProblems()"><span>è¡€æ “ç—‡æ­´</span></label>
              <label class="checkbox-item"><input type="checkbox" id="asthma" onchange="updateProblems()"><span>å–˜æ¯</span></label>
              <label class="checkbox-item"><input type="checkbox" id="psychiatric" onchange="updateProblems()"><span>ç²¾ç¥ç–¾æ‚£</span></label>
              <label class="checkbox-item"><input type="checkbox" id="uterineFibroid" onchange="updateProblems()"><span>å­å®®ç­‹è…«</span></label>
              <label class="checkbox-item"><input type="checkbox" id="uterineAnomaly" onchange="updateProblems()"><span>å­å®®å¥‡å½¢</span></label>
              <label class="checkbox-item"><input type="checkbox" id="cervicalSurgery" onchange="updateProblems()"><span>å­å®®é ¸éƒ¨æ‰‹è¡“æ­´</span></label>
              <label class="checkbox-item"><input type="checkbox" id="abdominalSurgery" onchange="updateProblems()"><span>è…¹éƒ¨æ‰‹è¡“æ­´</span></label>
            </div>
          </div>
        </div>

        <!-- 3. å†…æœè–¬ -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('meds')">
            <span>3. å†…æœè–¬ï¼ˆå‚¬å¥‡å½¢æ€§ï¼‰</span>
            <span id="meds-icon">â–²</span>
          </button>
          <div id="meds-content" class="section-content">
            <div class="alert-box alert-red">âš ï¸ å‚¬å¥‡å½¢æ€§ãƒªã‚¹ã‚¯ã®ã‚ã‚‹è–¬å‰¤</div>
            <div class="subsection-title red">æŠ—ã¦ã‚“ã‹ã‚“è–¬</div>
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="aed_valproate" onchange="updateProblems()"><span>ãƒãƒ«ãƒ—ãƒ­é…¸</span></label>
              <label class="checkbox-item"><input type="checkbox" id="aed_carbamazepine" onchange="updateProblems()"><span>ã‚«ãƒ«ãƒãƒã‚¼ãƒ”ãƒ³</span></label>
              <label class="checkbox-item"><input type="checkbox" id="aed_phenytoin" onchange="updateProblems()"><span>ãƒ•ã‚§ãƒ‹ãƒˆã‚¤ãƒ³</span></label>
              <label class="checkbox-item"><input type="checkbox" id="aed_other" onchange="updateProblems()"><span>ãã®ä»–æŠ—ã¦ã‚“ã‹ã‚“è–¬</span></label>
            </div>
            <div class="subsection-title red">ãƒ¬ãƒãƒã‚¤ãƒ‰</div>
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="retinoid_isotretinoin" onchange="updateProblems()"><span>ã‚¤ã‚½ãƒˆãƒ¬ãƒãƒã‚¤ãƒ³</span></label>
              <label class="checkbox-item"><input type="checkbox" id="retinoid_acitretin" onchange="updateProblems()"><span>ã‚¢ã‚·ãƒˆãƒ¬ãƒãƒ³</span></label>
            </div>
            <div class="subsection-title red">å…ç–«æŠ‘åˆ¶è–¬</div>
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="immunosuppressant_mtx" onchange="updateProblems()"><span>ãƒ¡ãƒˆãƒˆãƒ¬ã‚­ã‚µãƒ¼ãƒˆ</span></label>
              <label class="checkbox-item"><input type="checkbox" id="immunosuppressant_mmf" onchange="updateProblems()"><span>ãƒŸã‚³ãƒ•ã‚§ãƒãƒ¼ãƒ«é…¸</span></label>
              <label class="checkbox-item"><input type="checkbox" id="immunosuppressant_cyclophosphamide" onchange="updateProblems()"><span>ã‚·ã‚¯ãƒ­ãƒ›ã‚¹ãƒ•ã‚¡ãƒŸãƒ‰</span></label>
            </div>
            <div class="subsection-title orange">ãã®ä»–</div>
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="antihypertensive_acei" onchange="updateProblems()"><span>ACEé˜»å®³è–¬</span></label>
              <label class="checkbox-item"><input type="checkbox" id="antihypertensive_arb" onchange="updateProblems()"><span>ARB</span></label>
              <label class="checkbox-item"><input type="checkbox" id="anticoagulant_warfarin" onchange="updateProblems()"><span>ãƒ¯ãƒ«ãƒ•ã‚¡ãƒªãƒ³</span></label>
              <label class="checkbox-item"><input type="checkbox" id="thyroid_thiamazole" onchange="updateProblems()"><span>ãƒã‚¢ãƒã‚¾ãƒ¼ãƒ«</span></label>
              <label class="checkbox-item"><input type="checkbox" id="psychiatric_meds" onchange="updateProblems()"><span>ç²¾ç¥ç§‘è–¬</span></label>
            </div>
          </div>
        </div>

        <!-- 4. ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('allergy')">
            <span>4. ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</span>
            <span id="allergy-icon">â–²</span>
          </button>
          <div id="allergy-content" class="section-content">
            <div class="subsection-title red">é«˜ãƒªã‚¹ã‚¯</div>
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="allergy_latex" onchange="updateProblems()"><span>ãƒ©ãƒ†ãƒƒã‚¯ã‚¹</span></label>
              <label class="checkbox-item"><input type="checkbox" id="allergy_chlorhexidine" onchange="updateProblems()"><span>ã‚¯ãƒ­ãƒ«ãƒ˜ã‚­ã‚·ã‚¸ãƒ³</span></label>
            </div>
            <div class="subsection-title orange">æŠ—èŒè–¬</div>
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="allergy_penicillin" onchange="updateProblems()"><span>ãƒšãƒ‹ã‚·ãƒªãƒ³ç³»</span></label>
              <label class="checkbox-item"><input type="checkbox" id="allergy_cephalosporin" onchange="updateProblems()"><span>ã‚»ãƒ•ã‚§ãƒ ç³»</span></label>
            </div>
            <div class="subsection-title orange">ãã®ä»–</div>
            <div class="checkbox-grid">
              <label class="checkbox-item"><input type="checkbox" id="allergy_localanesthetic" onchange="updateProblems()"><span>å±€æ‰€éº»é…”è–¬</span></label>
              <label class="checkbox-item"><input type="checkbox" id="allergy_iodine" onchange="updateProblems()"><span>ãƒ¨ãƒ¼ãƒ‰é€ å½±å‰¤</span></label>
              <label class="checkbox-item"><input type="checkbox" id="allergy_nsaids" onchange="updateProblems()"><span>NSAIDs</span></label>
            </div>
          </div>
        </div>

        <!-- 5. æ„ŸæŸ“ç—‡ -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('infection')">
            <span>5. æ„ŸæŸ“ç—‡</span>
            <span id="infection-icon">â–²</span>
          </button>
          <div id="infection-content" class="section-content">
            <div class="form-row">
              <div class="form-group">
                <label>æ¢…æ¯’(TPHA)</label>
                <select id="syphilis_tpha" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label>æ¢…æ¯’(RPR)</label>
                <select id="syphilis_rpr" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>HBs-Ag</label>
                <select id="hbsag" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label>HCV-Ab</label>
                <select id="hcv" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>HIV-Ab</label>
                <select id="hiv" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label>HTLV-1-Ab</label>
                <select id="htlv1" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>é¢¨ç–¹(HI)</label>
                <select id="rubella" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="2">2å€</option>
                  <option value="4">4å€</option>
                  <option value="8">8å€</option>
                  <option value="16">16å€</option>
                  <option value="32">32å€</option>
                  <option value="64">64å€</option>
                  <option value="128">128å€</option>
                  <option value="256">256å€</option>
                  <option value="512">512å€ä»¥ä¸Š</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label>ãƒˆã‚­ã‚½IgM</label>
                <select id="toxoplasma_igm" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>CMV IgM</label>
                <select id="cmv_igm" onchange="updateProblems()">
                  <option value="">é¸æŠ</option>
                  <option value="é™°æ€§">é™°æ€§</option>
                  <option value="é™½æ€§">é™½æ€§</option>
                  <option value="æœªæ¤œæŸ»">æœªæ¤œæŸ»</option>
                </select>
              </div>
              <div class="form-group">
                <label>&nbsp;</label>
                <label class="checkbox-item" style="margin-top:6px;"><input type="checkbox" id="gbsPositive" onchange="updateProblems()"><span>GBSé™½æ€§</span></label>
              </div>
            </div>
          </div>
        </div>

        <!-- 6. ç”Ÿæ´»ãƒ»ç¤¾ä¼šèƒŒæ™¯ -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('social')">
            <span>6. ç”Ÿæ´»ãƒ»ç¤¾ä¼šèƒŒæ™¯</span>
            <span id="social-icon">â–²</span>
          </button>
          <div id="social-content" class="section-content">
            <div class="form-group">
              <label>æ‚£è€…éƒµä¾¿ç•ªå·</label>
              <div class="postal-row">
                <input type="text" id="postalCode" inputmode="numeric" placeholder="ä¾‹: 0600001" maxlength="8">
                <button class="btn btn-blue" id="calcBtn" onclick="calculateTravelTime()">è¨ˆç®—</button>
              </div>
              <div class="hint">ç—…é™¢: ã€’007-8505</div>
            </div>
            <div class="form-group">
              <label>è»Šã§ã®æ‰€è¦æ™‚é–“</label>
              <select id="travelTime" onchange="updateProblems()">
                <option value="">APIã§è¨ˆç®—ã¾ãŸã¯æ‰‹å‹•é¸æŠ</option>
                <option value="10åˆ†ä»¥å†…">10åˆ†ä»¥å†…</option>
                <option value="20åˆ†ä»¥å†…">20åˆ†ä»¥å†…</option>
                <option value="30åˆ†ä»¥å†…">30åˆ†ä»¥å†…</option>
                <option value="40åˆ†ä»¥å†…">40åˆ†ä»¥å†…</option>
                <option value="50åˆ†ä»¥å†…">50åˆ†ä»¥å†…</option>
                <option value="60åˆ†ä»¥ä¸Š">60åˆ†ä»¥ä¸Š</option>
              </select>
            </div>
            <div class="form-group">
              <label>å®¶æ—ã‚µãƒãƒ¼ãƒˆ</label>
              <div class="radio-group">
                <label class="radio-item"><input type="radio" name="familySupport" value="ååˆ†" checked onchange="updateProblems()"><span>ååˆ†</span></label>
                <label class="radio-item"><input type="radio" name="familySupport" value="ä¸€éƒ¨" onchange="updateProblems()"><span>ä¸€éƒ¨</span></label>
                <label class="radio-item"><input type="radio" name="familySupport" value="ã»ã¼ãªã—" onchange="updateProblems()"><span>ã»ã¼ãªã—</span></label>
              </div>
            </div>
            <div class="form-group">
              <label>ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</label>
              <div class="radio-group">
                <label class="radio-item"><input type="radio" name="partner" value="ã‚ã‚Š" checked onchange="updateProblems()"><span>ã‚ã‚Š</span></label>
                <label class="radio-item"><input type="radio" name="partner" value="åˆ¥å±…" onchange="updateProblems()"><span>åˆ¥å±…</span></label>
                <label class="radio-item"><input type="radio" name="partner" value="ãªã—" onchange="updateProblems()"><span>ãªã—</span></label>
              </div>
            </div>
            <label class="checkbox-item"><input type="checkbox" id="married" checked onchange="updateProblems()"><span>æ—¢å©š</span></label>
            <div class="form-group">
              <label>ä¸Šã®å­ã®é ã‘å…ˆ</label>
              <div class="radio-group">
                <label class="radio-item"><input type="radio" name="childCare" value="æ±ºã¾ã£ã¦ã„ã‚‹" checked onchange="updateProblems()"><span>æ±ºã¾ã£ã¦ã„ã‚‹</span></label>
                <label class="radio-item"><input type="radio" name="childCare" value="æœªå®š" onchange="updateProblems()"><span>æœªå®š</span></label>
              </div>
            </div>
          </div>
        </div>

        <!-- 7. ç”Ÿæ´»ç¿’æ…£ -->
        <div class="section">
          <button class="section-header" onclick="toggleSection('lifestyle')">
            <span>7. ç”Ÿæ´»ç¿’æ…£</span>
            <span id="lifestyle-icon">â–²</span>
          </button>
          <div id="lifestyle-content" class="section-content">
            <label class="checkbox-item"><input type="checkbox" id="smoking" onchange="updateProblems()"><span>å–«ç…™ï¼ˆæœ¬äººã¾ãŸã¯åŒå±…å®¶æ—ï¼‰</span></label>
            <label class="checkbox-item"><input type="checkbox" id="alcohol" onchange="updateProblems()"><span>é£²é…’</span></label>
          </div>
        </div>
      </div>

      <!-- å³ã‚«ãƒ©ãƒ : ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãƒªã‚¹ãƒˆ -->
      <div class="problem-column">
        <div class="problem-panel">
          <div class="problem-header">
            <h2>ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãƒªã‚¹ãƒˆ</h2>
            <button class="btn btn-blue" id="copyBtn" onclick="copyProblems()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
          </div>
          <div id="problemList" class="problem-list">
            <div class="empty-message">ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãªã—</div>
          </div>
          <div class="legend">
            <h3>å‡¡ä¾‹</h3>
            <div class="legend-item"><div class="legend-box high"></div><span>é«˜ãƒªã‚¹ã‚¯</span></div>
            <div class="legend-item"><div class="legend-box medium"></div><span>ä¸­ãƒªã‚¹ã‚¯</span></div>
            <div class="legend-item"><div class="legend-box low"></div><span>æ³¨æ„äº‹é …</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">ç”£ç§‘å•è¨ºãƒ—ãƒ­ãƒ–ãƒ¬ãƒ æŠ½å‡º v1.0</div>
  </div>

  <script>
    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹é–‰
    function toggleSection(name) {
      const content = document.getElementById(name + '-content');
      const icon = document.getElementById(name + '-icon');
      if (content.classList.contains('open')) {
        content.classList.remove('open');
        icon.textContent = 'â–¼';
      } else {
        content.classList.add('open');
        icon.textContent = 'â–²';
      }
    }

    // BMIè¨ˆç®—
    function calcBMI() {
      const h = parseFloat(document.getElementById('height').value);
      const w = parseFloat(document.getElementById('preWeight').value);
      if (h && w) {
        const bmi = w / ((h / 100) ** 2);
        document.getElementById('bmi').value = bmi.toFixed(1);
        return bmi;
      }
      document.getElementById('bmi').value = '---';
      return null;
    }

    // æ‰€è¦æ™‚é–“è¨ˆç®—ï¼ˆAPIï¼‰
    async function calculateTravelTime() {
      const code = document.getElementById('postalCode').value.replace(/[^0-9]/g, '');
      if (code.length !== 7) {
        alert('éƒµä¾¿ç•ªå·ã¯7æ¡ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      const btn = document.getElementById('calcBtn');
      btn.disabled = true;
      btn.textContent = '...';
      try {
        const res = await fetch('https://travel-time-api.vercel.app/api/travel-time?postalCode=' + code);
        if (!res.ok) throw new Error('API Error');
        const data = await res.json();
        const mins = data.carMinutes;
        let cat;
        if (mins <= 10) cat = '10åˆ†ä»¥å†…';
        else if (mins <= 20) cat = '20åˆ†ä»¥å†…';
        else if (mins <= 30) cat = '30åˆ†ä»¥å†…';
        else if (mins <= 40) cat = '40åˆ†ä»¥å†…';
        else if (mins <= 50) cat = '50åˆ†ä»¥å†…';
        else cat = '60åˆ†ä»¥ä¸Š';
        document.getElementById('travelTime').value = cat;
        updateProblems();
      } catch (e) {
        alert('ç§»å‹•æ™‚é–“ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æ‰‹å‹•ã§é¸æŠã—ã¦ãã ã•ã„ã€‚');
      } finally {
        btn.disabled = false;
        btn.textContent = 'è¨ˆç®—';
      }
    }

    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³å€¤å–å¾—
    function getRadio(name) {
      const el = document.querySelector('input[name="' + name + '"]:checked');
      return el ? el.value : '';
    }

    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å€¤å–å¾—
    function getCheck(id) {
      const el = document.getElementById(id);
      return el ? el.checked : false;
    }

    // ã‚»ãƒ¬ã‚¯ãƒˆå€¤å–å¾—
    function getSelect(id) {
      const el = document.getElementById(id);
      return el ? el.value : '';
    }

    // æ•°å€¤å–å¾—
    function getNum(id) {
      return parseInt(document.getElementById(id).value) || 0;
    }

    // ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ æŠ½å‡º
    function updateProblems() {
      const bmi = calcBMI();
      const problems = [];

      // é«˜ãƒªã‚¹ã‚¯
      if (getCheck('prevAdhesion') || (getNum('cesarean') > 0 && getCheck('prevPlacenta'))) {
        problems.push({ text: '#ç™’ç€èƒç›¤æ³¨æ„', level: 'high' });
      }
      if (getCheck('prevHDP')) problems.push({ text: '#å‰å›HDP', level: 'high' });
      if (getCheck('prevPreterm')) problems.push({ text: '#å‰å›æ—©ç”£', level: 'high' });
      if (getCheck('prevPPH')) problems.push({ text: '#å‰å›ç”£å¾Œå‡ºè¡€', level: 'high' });
      if (getCheck('thrombosis')) problems.push({ text: '#è¡€æ “ç—‡æ—¢å¾€', level: 'high' });
      if (getCheck('autoimmune')) problems.push({ text: '#è‡ªå·±å…ç–«ç–¾æ‚£', level: 'high' });
      if (getCheck('diabetes')) problems.push({ text: '#ç³–å°¿ç—…åˆä½µ', level: 'high' });

      // å‚¬å¥‡å½¢æ€§ï¼ˆé«˜ï¼‰
      if (getCheck('aed_valproate')) problems.push({ text: '#ãƒãƒ«ãƒ—ãƒ­é…¸å†…æœä¸­', level: 'high' });
      if (getCheck('retinoid_isotretinoin') || getCheck('retinoid_acitretin')) {
        problems.push({ text: '#ãƒ¬ãƒãƒã‚¤ãƒ‰å†…æœä¸­ï¼ˆçµ¶å¯¾ç¦å¿Œï¼‰', level: 'high' });
      }
      if (getCheck('immunosuppressant_mtx')) problems.push({ text: '#ãƒ¡ãƒˆãƒˆãƒ¬ã‚­ã‚µãƒ¼ãƒˆå†…æœä¸­ï¼ˆç¦å¿Œï¼‰', level: 'high' });
      if (getCheck('immunosuppressant_mmf') || getCheck('immunosuppressant_cyclophosphamide')) {
        problems.push({ text: '#å…ç–«æŠ‘åˆ¶è–¬å†…æœä¸­ï¼ˆç¦å¿Œï¼‰', level: 'high' });
      }
      if (getCheck('anticoagulant_warfarin')) problems.push({ text: '#ãƒ¯ãƒ«ãƒ•ã‚¡ãƒªãƒ³å†…æœä¸­ï¼ˆè¦å¤‰æ›´ï¼‰', level: 'high' });

      // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ï¼ˆé«˜ï¼‰
      if (getCheck('allergy_latex')) problems.push({ text: '#ãƒ©ãƒ†ãƒƒã‚¯ã‚¹ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'high' });
      if (getCheck('allergy_chlorhexidine')) problems.push({ text: '#ã‚¯ãƒ­ãƒ«ãƒ˜ã‚­ã‚·ã‚¸ãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'high' });

      // æ„ŸæŸ“ç—‡ï¼ˆé«˜ï¼‰
      if (getSelect('syphilis_tpha') === 'é™½æ€§' || getSelect('syphilis_rpr') === 'é™½æ€§') {
        problems.push({ text: '#æ¢…æ¯’é™½æ€§', level: 'high' });
      }
      if (getSelect('hbsag') === 'é™½æ€§') problems.push({ text: '#HBsæŠ—åŸé™½æ€§', level: 'high' });
      if (getSelect('hcv') === 'é™½æ€§') problems.push({ text: '#HCVæŠ—ä½“é™½æ€§', level: 'high' });
      if (getSelect('hiv') === 'é™½æ€§') problems.push({ text: '#HIVæŠ—ä½“é™½æ€§', level: 'high' });
      if (getSelect('toxoplasma_igm') === 'é™½æ€§') problems.push({ text: '#ãƒˆã‚­ã‚½ãƒ—ãƒ©ã‚ºãƒIgMé™½æ€§', level: 'high' });

      // ä¸­ãƒªã‚¹ã‚¯
      if (getNum('age') >= 35) problems.push({ text: '#é«˜é½¢å¦Šå¨ ', level: 'medium' });
      if (bmi && bmi >= 25) problems.push({ text: '#è‚¥æº€', level: 'medium' });
      if (bmi && bmi < 18.5) problems.push({ text: '#ã‚„ã›', level: 'medium' });
      if (getNum('cesarean') > 0) problems.push({ text: '#æ—¢å¾€å¸ç‹åˆ‡é–‹', level: 'medium' });
      if (getCheck('lastDeliveryWithin1Year')) problems.push({ text: '#å‰å›å¦Šå¨ ã‹ã‚‰1å¹´æœªæº€', level: 'medium' });
      if (getCheck('prevGDM')) problems.push({ text: '#å‰å›GDM', level: 'medium' });
      if (getCheck('psychiatric_meds')) problems.push({ text: '#ç²¾ç¥ç§‘è–¬å†…æœä¸­', level: 'medium' });
      if (getCheck('hypertension')) problems.push({ text: '#é«˜è¡€åœ§åˆä½µ', level: 'medium' });
      if (getCheck('thyroid')) problems.push({ text: '#ç”²çŠ¶è…ºç–¾æ‚£', level: 'medium' });
      if (getCheck('uterineAnomaly')) problems.push({ text: '#å­å®®å¥‡å½¢', level: 'medium' });
      if (getCheck('cervicalSurgery')) problems.push({ text: '#é ¸ç®¡æ‰‹è¡“æ—¢å¾€', level: 'medium' });
      if (getCheck('abdominalSurgery')) problems.push({ text: '#è…¹éƒ¨æ—¢å¾€æ‰‹è¡“ã‚ã‚Š', level: 'medium' });

      // å‚¬å¥‡å½¢æ€§ï¼ˆä¸­ï¼‰
      if (getCheck('aed_carbamazepine') || getCheck('aed_phenytoin') || getCheck('aed_other')) {
        problems.push({ text: '#æŠ—ã¦ã‚“ã‹ã‚“è–¬å†…æœä¸­', level: 'medium' });
      }
      if (getCheck('antihypertensive_acei') || getCheck('antihypertensive_arb')) {
        problems.push({ text: '#ACEé˜»å®³è–¬/ARBå†…æœä¸­ï¼ˆè¦å¤‰æ›´ï¼‰', level: 'medium' });
      }
      if (getCheck('thyroid_thiamazole')) problems.push({ text: '#ãƒã‚¢ãƒã‚¾ãƒ¼ãƒ«å†…æœä¸­ï¼ˆè¦æ³¨æ„ï¼‰', level: 'medium' });

      // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ï¼ˆä¸­ï¼‰
      if (getCheck('allergy_penicillin')) problems.push({ text: '#ãƒšãƒ‹ã‚·ãƒªãƒ³ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'medium' });
      if (getCheck('allergy_cephalosporin')) problems.push({ text: '#ã‚»ãƒ•ã‚§ãƒ ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'medium' });
      if (getCheck('allergy_localanesthetic')) problems.push({ text: '#å±€æ‰€éº»é…”è–¬ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'medium' });

      // æ„ŸæŸ“ç—‡ï¼ˆä¸­ï¼‰
      if (getSelect('htlv1') === 'é™½æ€§') problems.push({ text: '#HTLV-1æŠ—ä½“é™½æ€§', level: 'medium' });
      if (getSelect('cmv_igm') === 'é™½æ€§') problems.push({ text: '#ã‚µã‚¤ãƒˆãƒ¡ã‚¬ãƒ­IgMé™½æ€§', level: 'medium' });

      // ä½ãƒªã‚¹ã‚¯
      const travel = getSelect('travelTime');
      if (travel === '50åˆ†ä»¥å†…' || travel === '60åˆ†ä»¥ä¸Š') {
        problems.push({ text: '#é æ–¹åœ¨ä½', level: 'low' });
      }
      if (getCheck('gbsPositive')) problems.push({ text: '#GBSé™½æ€§', level: 'low' });
      if (getRadio('familySupport') === 'ã»ã¼ãªã—') problems.push({ text: '#å®¶æ—æ”¯æ´ãªã—', level: 'low' });
      if (getRadio('childCare') === 'æœªå®š') problems.push({ text: '#ä¸Šã®å­é ã‘å…ˆæœªå®š', level: 'low' });
      if (getCheck('prevRapidLabor')) problems.push({ text: '#å‰å›åˆ†å¨©çµŒéæ—©ã„', level: 'low' });
      if (getCheck('prevPROM')) problems.push({ text: '#å‰å›å‰æœŸç ´æ°´', level: 'low' });
      if (getNum('para') === 0) problems.push({ text: '#åˆç”£', level: 'low' });
      if (!getCheck('married')) problems.push({ text: '#æœªå©š', level: 'low' });
      const partner = getRadio('partner');
      if (partner === 'åˆ¥å±…' || partner === 'ãªã—') problems.push({ text: '#å¤«ãŒåˆ¥', level: 'low' });
      if (getCheck('smoking')) problems.push({ text: '#å–«ç…™', level: 'low' });
      if (getCheck('allergy_nsaids')) problems.push({ text: '#NSAIDsã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼', level: 'low' });
      const rubella = parseInt(getSelect('rubella'));
      if (rubella && rubella < 16) problems.push({ text: '#é¢¨ç–¹æŠ—ä½“ä½å€¤', level: 'low' });

      // è¡¨ç¤ºæ›´æ–°
      const list = document.getElementById('problemList');
      if (problems.length === 0) {
        list.innerHTML = '<div class="empty-message">ãƒ—ãƒ­ãƒ–ãƒ¬ãƒ ãªã—</div>';
      } else {
        list.innerHTML = problems.map(p => 
          '<div class="problem-item problem-' + p.level + '">' + p.text + '</div>'
        ).join('');
      }
    }

    // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
    function copyProblems() {
      const items = document.querySelectorAll('.problem-item');
      const texts = Array.from(items).map(el => el.textContent);
      const text = texts.join(', ');
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          const btn = document.getElementById('copyBtn');
          btn.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆ';
          setTimeout(() => { btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
        });
      } else {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        const btn = document.getElementById('copyBtn');
        btn.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆ';
        setTimeout(() => { btn.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼'; }, 2000);
      }
    }

    // ãƒªã‚»ãƒƒãƒˆ
    function resetForm() {
      if (!confirm('å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) return;
      
      // ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
      ['age', 'height', 'preWeight', 'basicOther', 'postalCode', 'gravida', 'para', 'cesarean'].forEach(id => {
        document.getElementById(id).value = '';
      });
      document.getElementById('bmi').value = '---';
      
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
      document.querySelectorAll('input[type="checkbox"]').forEach(el => {
        el.checked = (el.id === 'married');
      });
      
      // ã‚»ãƒ¬ã‚¯ãƒˆ
      document.querySelectorAll('select').forEach(el => {
        el.selectedIndex = 0;
      });
      
      // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³
      document.querySelector('input[name="familySupport"][value="ååˆ†"]').checked = true;
      document.querySelector('input[name="partner"][value="ã‚ã‚Š"]').checked = true;
      document.querySelector('input[name="childCare"][value="æ±ºã¾ã£ã¦ã„ã‚‹"]').checked = true;
      
      updateProblems();
    }

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      updateProblems();
    });
  </script>
</body>
</html>
